Checklist

Inspect SQL for syntax issues
Explain cause and provide corrected SQL
(Optional) Run verification query if you want
Problem

PostgreSQL does not support CREATE POLICY IF NOT EXISTS. The error "syntax error at or near 'NOT'" comes from the IF NOT EXISTS clause.
Fix

Remove IF NOT EXISTS and optionally guard creation with a DO block that checks pg_policies.
Corrected SQL (remove IF NOT EXISTS)

SQL Query



-- 1. Add policies for communitycomments
CREATE POLICY "public_read_comments"
ON public.communitycomments FOR SELECT
USING (true);

CREATE POLICY "auth_write_comments"
ON public.communitycomments FOR INSERT
TO authenticated
WITH CHECK (true);

-- 2. Add policies for communitythreads
CREATE POLICY "public_read_threads"
ON public.communitythreads FOR SELECT
USING (true);

CREATE POLICY "auth_write_threads"
ON public.communitythreads FOR INSERT
TO authenticated
WITH CHECK (true);

-- 3. Add policies for episodes
CREATE POLICY "public_read_episodes"
ON public.episodes FOR SELECT
USING (true);

-- 4. Add policies for notifications
CREATE POLICY "user_read_notifications"
ON public.notifications FOR SELECT
TO authenticated
USING (true);

-- 5. Add policies for videos
CREATE POLICY "public_read_videos"
ON public.videos FOR SELECT
USING (true);

Alternative: create only if missing (safe)

SQL Query



DO $$
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM pg_policies p
    WHERE p.schemaname = 'public' AND p.tablename = 'communitycomments' AND p.policyname = 'public_read_comments'
  ) THEN
    CREATE POLICY "public_read_comments" ON public.communitycomments FOR SELECT USING (true);
  END IF;

  IF NOT EXISTS (
    SELECT 1 FROM pg_policies p
    WHERE p.schemaname = 'public' AND p.tablename = 'communitycomments' AND p.policyname = 'auth_write_comments'
  ) THEN
    CREATE POLICY "auth_write_comments" ON public.communitycomments FOR INSERT TO authenticated WITH CHECK (true);
  END IF;

  -- repeat similar IF NOT EXISTS checks for the other policies...
END$$;

